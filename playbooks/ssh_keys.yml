---
- hosts: localhost, master[0]
  roles:
  - configure_ssh/create_key_pair

- hosts: all
  roles:
  - configure_ssh/add_authorized_key

- hosts: master[0]
  roles:
  - configure_ssh/get_node_pubkey

- hosts: all, !master[0]
  tasks:
  - name: master0 pubkey copy to all-nodes
    authorized_key:
      user: "{{ ansible_env.USER }}"
      key: "{{ lookup('file', '/var/tmp/pubkey' )}}"
